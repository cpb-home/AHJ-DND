(()=>{"use strict";const t=t=>{let e,r;switch(t.toLowerCase()){case"green":e="Add card",r="button buttonAdd";break;case"red":e="Cancell",r="button buttonCancell";break;default:e="No text",r="button"}const a=document.createElement("button");return a.className=r,a.type="button",a.textContent=e,a};class e{constructor(t){this.title=t,this.root=document.getElementById("root"),this.cards=[],this.latestId=0,this.flagDeleted=!1,this.flagAdded=!1}render(){const t=this.createCol(),e=this.createHeader(),r=this.createCardList(),a=this.createFooter();t.append(e),t.append(r),t.append(a),this.root.append(t)}createCol(){const t=document.createElement("div");return t.classList.add("column"),t}createHeader(){const t=document.createElement("header");return t.classList.add("column__header"),t.textContent=this.title,t}createCardList(){const t=document.createElement("div");if(t.classList.add("cardList"),t.dataset.title=this.title,localStorage.cards){const t=this.readFromLS();t&&(this.cards=[],t.forEach((t=>{this.cards.push(t)})))}for(let e=0;e<this.cards.length;e++){const r=this.createCard(e);t.append(r)}return 0===this.cards.length?(t.classList.add("bordered"),t.textContent="Карточку можно перетащить сюда."):t.classList.remove("bordered"),t}createCard(t){const e=((t,e)=>{const r=document.createElement("div");return r.classList.add("card"),r.dataset.id=t,r.draggable=!0,r.textContent=e,r})(t,this.cards[t]),r=document.createElement("span");return r.classList.add("card-closeBtn"),r.addEventListener("click",(t=>{confirm("Are you sure to delete this note?")&&this.deleteCard(t)})),e.append(r),e}createFooter(){const t=document.createElement("footer");t.classList.add("column__footer");const e=this.createFooterCont(t);return t.append(e),t}createFooterCont(t){const e=document.createElement("div");return e.classList.add("footerCont"),e.textContent="+ Add another card",e.addEventListener("click",(()=>this.openAddingCart(t))),e}openAddingCart(e){e.textContent="";const r=document.createElement("div");r.classList.add("footerAdd"),e.style.padding="10px 0 0";const a=document.createElement("textarea");a.classList.add("footerArea"),r.append(a);const s=document.createElement("div");s.classList.add("buttonsBlock");const n=t("green");n.addEventListener("click",(t=>{const e=t.target.closest(".column__footer").querySelector(".footerArea");""!==e.value&&this.addCard(e.value,t)})),s.append(n);const o=t("red");o.addEventListener("click",(t=>this.restoreFooter(t))),s.append(o),e.append(r),e.append(s)}addCard(t,e){this.cards.push(t),this.saveToLS();const r=e.target.closest(".column").querySelector(".cardList");r.textContent="";for(let t=0;t<this.cards.length;t++){const e=this.createCard(t);r.append(e)}r.classList.remove("bordered"),this.restoreFooter(e)}deleteCard(t){const e=t.target.closest(".card").dataset.id;this.removeCardFromArr(e),this.saveToLS();const r=t.target.closest(".cardList");r.textContent="";for(let t=0;t<this.cards.length;t++){const e=this.createCard(t);r.append(e)}0===this.cards.length?(r.classList.add("bordered"),r.textContent="Карточку можно перетащить сюда."):r.classList.remove("bordered")}removeCardFromArr(t){this.cards.splice(t,1)}restoreFooter(t){const e=t.target.closest(".column__footer");e.textContent="",e.style.padding="10px 10px 0";const r=this.createFooterCont(e);e.append(r)}saveToLS(){if(localStorage.cards){const t=JSON.parse(localStorage.getItem("cards")),e=t.find((t=>t.title===this.title));e?e.content=this.cards:t.push({title:this.title,content:this.cards}),localStorage.setItem("cards",JSON.stringify(t))}else localStorage.setItem("cards",JSON.stringify([{title:this.title,content:this.cards}]))}readFromLS(){if(localStorage.cards){const t=JSON.parse(localStorage.getItem("cards")).find((t=>t.title===this.title));return t?t.content:null}}restoreAfterDragged(t,e,r){if(e&&t){if(this.title===e.dataset.title&&!this.flagAdded){const t=e.querySelectorAll(".card");if(t.length>0)for(let a=0;a<t.length;a++)if(t[a].textContent!==this.cards[a]){this.cards.splice(a,0,r.textContent),e.textContent="";for(let t=0;t<this.cards.length;t++){const r=this.createCard(t);e.append(r)}this.cardDragger();break}this.flagAdded=!0}if(this.title===t.dataset.title&&!this.flagDeleted){this.cards.splice(r.dataset.id,1),t.textContent="";for(let e=0;e<this.cards.length;e++){const r=this.createCard(e);t.append(r)}this.cardDragger(),this.flagDeleted=!0,console.log(this.cards)}}}}const r=new e("todo"),a=new e("in progress"),s=new e("done");function n(t){return"todo"===t.dataset.title?r:"in progress"===t.dataset.title?a:"done"===t.dataset.title?s:null}r.render(),a.render(),s.render(),function(){let t,e,r;const a=t=>{const e=t.target.getBoundingClientRect(),r=e.y+e.height/2;return t.clientY<r},s=()=>{document.querySelector(".phantom")&&document.querySelector(".phantom").remove()};document.querySelector("#root").addEventListener("dragstart",(r=>(r=>{t=r.target,e=r.target.closest(".cardList")})(r)));const o=document.querySelector("#root");o.addEventListener("dragover",(e=>(e=>{e.preventDefault();const r=t.offsetHeight,n=t.offsetWidth,o=document.createElement("div");let c;if(o.classList.add("phantom"),o.style.height=r+"px",o.style.width=n+"px",e.target.classList.contains("card")||e.target.classList.contains("cardList"))if(document.querySelector(".phantom")){if(c===e.target||c===t||c===o)return;if(s(),e.target.classList.contains("card"))a(e)?e.target.before(o):e.target.after(o);else{const t=e.target.querySelectorAll(".card");if(t.length>0)for(let r=0;r<t.length;r++){if(!t[r+1]){if(t[r].getBoundingClientRect().y<e.clientY){t[r].after(o);break}t[r].before(o);break}if(t[r].getBoundingClientRect().y<e.clientY&&t[r+1].getBoundingClientRect().y>e.clientY){t[r].after(o);break}}else e.target.textContent="",e.target.append(o),e.target.classList.remove("bordered")}}else if(c=e.target,e.target.classList.contains("card"))a(e)?e.target.before(o):e.target.after(o);else{const t=e.target.querySelectorAll(".card");if(t.length>0){for(let r=0;r<t.length;r++)if(t[r+1]){if(t[r].getBoundingClientRect().y<e.clientY&&t[r+1].getBoundingClientRect().y>e.clientY){t[r].after(o);break}if(t[r].getBoundingClientRect().y<e.clientY){t[r].after(o);break}t[r].before(o);break}}else e.target.textContent="",s(),e.target.append(o),e.target.classList.remove("bordered")}})(e))),o.addEventListener("drop",(e=>(e=>{if(e.target.classList.contains("card")||e.target.classList.contains("cardList")||e.target.classList.contains("phantom"))if(e.target.classList.contains("card"))a(e)?e.target.before(t):e.target.after(t);else if(e.target.classList.contains("cardList")){const r=e.target.querySelectorAll(".card");if(r.length>0)for(let a=0;a<r.length;a++){if(!r[a+1]){if(r[a].getBoundingClientRect().y<e.clientY){r[a].after(t);break}r[a].before(t);break}if(r[a].getBoundingClientRect().y<e.clientY&&r[a+1].getBoundingClientRect().y>e.clientY){r[a].after(t);break}}else e.target.textContent="",e.target.append(t),e.target.classList.remove("bordered")}else e.target.before(t),s()})(e)));o.addEventListener("dragend",(()=>(s(),r=t.closest(".cardList"),void function(t,e,r){e&&t&&(t!==e?(function(t,e){const r=t.querySelectorAll(".card"),a=n(t);for(let s=0;s<r.length;s++)if(r[s].textContent!==a.cards[s]){a.cards.splice(s,0,e.textContent),t.textContent="";for(let e=0;e<a.cards.length;e++){const r=a.createCard(e);t.append(r)}break}a.saveToLS()}(e,r),function(t,e){const r=n(t);r.cards.splice(e.dataset.id,1),t.textContent="";for(let e=0;e<r.cards.length;e++){const a=r.createCard(e);t.append(a)}0===r.cards.length?(t.classList.add("bordered"),t.textContent="Карточку можно перетащить сюда."):t.classList.remove("bordered"),r.saveToLS()}(t,r)):function(t,e){const r=n(t),a=t.querySelectorAll(".card");let s="";a.forEach(((t,r)=>{t.dataset.id===e.dataset.id&&(s=r)})),r.cards.splice(e.dataset.id,1),r.cards.splice(s,0,e.textContent),t.textContent="";for(let e=0;e<r.cards.length;e++){const a=r.createCard(e);t.append(a)}r.saveToLS()}(t,r))}(e,r,t))))}()})();